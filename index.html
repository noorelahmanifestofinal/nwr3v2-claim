<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>ğŸš€ NWR3v2 Claim Portal</title>
  <style>
    body { background:#111; color:#afa; font-family:sans-serif; text-align:center; padding:50px; }
    button { padding:12px 24px; font-size:1rem; margin:10px; border:none; border-radius:6px; cursor:pointer; }
    #connect { background:#1E90FF; color:#fff; }
    #approve { background:#FFA500; color:#fff; }
    #claim   { background:#28a745; color:#fff; }
    #status  { margin-top:20px; font-size:1.1rem; }
  </style>
</head>
<body>

<h1>ğŸš€ NWR3v2 Claim Portal</h1>
<button id="connect">Connect MetaMask</button><br/>
<button id="approve" disabled>âš™ Approve Tokens</button>
<button id="claim" disabled>ğŸ’§ Claim Now</button>
<div id="status"></div>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
<script>
const CONTRACT_ADDRESS = "0xe830ebbDC2E201Dc1b3e96Fb3a0cbfd0e5215F48";
const TOKEN_ADDRESS    = "0x65ca48d3D1d7356EC99cE6BD3736B54eFdfA837E";
const CLAIM_ABI = ["function claimNWR3v2() external"];
const ERC20_ABI = [
  "function approve(address,uint256) external returns(bool)",
  "function allowance(address,address) view returns(uint256)"
];

let provider, signer, contract, tokenContract, decimals;

const btnConnect = document.getElementById("connect");
const btnApprove = document.getElementById("approve");
const btnClaim   = document.getElementById("claim");
const statusEl   = document.getElementById("status");

btnConnect.onclick = async () => {
  try {
    provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const network = await provider.getNetwork();
    if (network.chainId !== 137) {
      statusEl.innerText = "âš ï¸ Switch to Polygon mainnet!";
      return;
    }
    signer = await provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, CLAIM_ABI, signer);
    tokenContract = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, signer);
    decimals = 18; // assume 18
    btnApprove.disabled = false;
    statusEl.innerText = "âœ… Connected (18 decimals assumed)";
  } catch (e) {
    console.error(e);
    statusEl.innerText = "âŒ Connection failed.";
  }
};

btnApprove.onclick = async () => {
  try {
    const amt = ethers.parseUnits("1000000000", decimals); // 1e9 * 10^18
    const tx = await tokenContract.approve(CONTRACT_ADDRESS, amt);
    await tx.wait();
    statusEl.innerText = "âœ… Approved!";
    btnClaim.disabled = false;
  } catch (e) {
    console.error(e);
    statusEl.innerText = "âŒ Approval error.";
  }
};

btnClaim.onclick = async () => {
  try {
    // Optionally check allowance...
    const tx = await contract.claimNWR3v2();
    await tx.wait();
    statusEl.innerText = "ğŸ‰ Claimed!";
  } catch (e) {
    console.error(e);
    statusEl.innerText = "âŒ Claim failed.";
  }
};
</script>

</body>
</html>
